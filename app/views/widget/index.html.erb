<h2>Hello World</h2>
<%=session[:expires_at].inspect %>

<p><%= flash[:notice] %></p>
<% if !session[:user_token] || !session[:userinfo] %>
  <button onclick="$('div#user_management').toggle()">Login</button> </br>
<% end %>

<div id="search">
  <%= render 'form_search' %>
</div>

<div id="user_management" class="user_management" style="display: none">
  <div id="background_grey"></div>
  <div id="user_form">
    <span><button class="close-button" onclick="$('#user_management').hide()">X</button> </span>
    <%= render 'sessions/form_login' %>
  </div>
</div>

<div id="users_resetpwd" class="user_management" style="display: none">
  <div id="background_grey"></div>
  <div id="user_form">
    <button class="close-button" onclick="$('#users_resetpwd').hide()">X</button>
    <%= render 'users/form_resetpwd' %>
  </div>
</div>

<div id="users_register" class="user_management" style="display: none">
  <div id="background_grey"></div>
  <div id="user_form">
    <button class="close-button" onclick="$('#users_register').hide()">X</button>
    <%= form_for :register, url: :users_register do |f| %>
      <p><%= f.label :first_name %>: <%= f.text_field :first_name %></p>
      <p><%= f.label :last_name %>: <%= f.text_field :last_name %></p>
      <p><%= f.label :password %>: <%= f.password_field :password %></p>
      <p><%= f.label :email %>: <%= f.text_field :email %></p>
      <p><%= f.label :image_url %>: <%= f.text_field :image_url %></p>
      <p><%= recaptcha_tags %></p>
      <p><%= f.submit("submit") %></p>
    <% end %>
  </div>
</div>

<% if session[:user_token] && session[:userinfo] %>
  <div id="user_information" style="display: block">
    <table border="1" class="user_information">
      <tr><td colspan="4">Welcome, <%= session[:userinfo]['user']['name'] %></td></tr>
      <tr>
        <td><%=button_to 'My Widgets', users_index_me_url, method: :get %></td>
        <td><button onclick="$('#user_update').toggle();">Update Profile</button></td>
        <td><button onclick="$('#users_changepwd').toggle()">Change Password</button></td>
        <td><%=button_to 'Logout', sessions_logout_url%></td>
      </tr>
    </table>
  </div>

  <div id="user_update" class="user_management" style="display: none">
    <div id="background_grey"></div>
    <div id="user_form">
      <span>Update Profile</span>
      <button class="close-button" onclick="$('#user_update').hide()">X</button>
      <%=render 'users/form_update' %>
    </div>
  </div>

  <div id="users_changepwd" class="user_management" style="display: none">
    <div id="background_grey"></div>
    <div id="user_form">
      <button class="close-button" onclick="$('#users_changepwd').hide()">X</button>
      <%=render 'users/form_changepwd' %>
    </div>
  </div>
<% end %>

<div>
  <% @widgets_view_public = @widgets_search if @widgets_search %>
  <table>
    <tr><th>ID</th><th>Name</th><th>Desc</th><th>user</th><th>owner</th></tr>
    <% @widgets_view_public['widgets'].each do |i, index| %>
      <tr>
        <td><%= i['id'] %></td>
        <td><%= i['name'] %></td>
        <td><%= i['description'] %></td>
        <td><%= i['user']['first_name']+' '+i['user']['last_name'] %></td>
        <td><%= i['owner'] %></td>
      </tr>
    <% end %>
  </table>
</div>




